<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ðŸ’¬ Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„ØºØ±ÙˆØ¨</title>
  <style>
    body { font-family: 'Tajawal', sans-serif; background: #fafafa; padding: 2rem; }
    #chat-box { border: 1px solid #ccc; height: 400px; overflow-y: auto; padding: 1rem; margin-bottom: 1rem; background: white; }
    #message { width: 80%; padding: 0.7rem; }
    #sendBtn { padding: 0.7rem 1.5rem; background: #1976d2; color: white; border: none; border-radius: 10px; }
    #sendBtn:hover { background: #135ba1; }
  </style>
</head>
<body>

  <h2>ðŸ’¬ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©</h2>
  <div id="chat-box"></div>
  <input type="text" id="message" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ..." />
  <button id="sendBtn">Ø¥Ø±Ø³Ø§Ù„</button>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAarHXsMOfclxmFM2cxQ5p4SoM32jLPsjU",
      authDomain: "chat-c451f.firebaseapp.com",
      projectId: "chat-c451f"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const chatBox = document.getElementById('chat-box');
    const messageInput = document.getElementById('message');
    const sendBtn = document.getElementById('sendBtn');
    const groupId = localStorage.getItem('currentGroupId') || null;

    if (!groupId) {
      alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø¥Ù„Ù‰ Ø£ÙŠ ØºØ±ÙˆØ¨');
      window.location.href = 'join-group.html';
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
    db.collection('messages')
      .where('groupId', '==', groupId)
      .orderBy('timestamp')
      .onSnapshot(snapshot => {
        chatBox.innerHTML = '';
        snapshot.forEach(doc => {
          const data = doc.data();
          const div = document.createElement('div');
          div.textContent = `${data.username || 'Ù…Ø¬Ù‡ÙˆÙ„'}: ${data.text}`;
          chatBox.appendChild(div);
        });
        chatBox.scrollTop = chatBox.scrollHeight;
      });

    // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©
    sendBtn.onclick = () => {
      const text = messageInput.value.trim();
      if (!text) return;
      db.collection('messages').add({
        text: text,
        username: 'Ø²Ø§Ø¦Ø±', // ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ±Ù‡ Ø¨Ø¥Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
        groupId: groupId
      });
      messageInput.value = '';
    };
  </script>
</body>
</html>


